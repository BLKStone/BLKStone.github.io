<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.3"/>


    <meta name="description" content="关于计算机科学的学习经历与精彩文章分享。" />



  <meta name="keywords" content="Android," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.3" />



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    analytics: {
      google: ''
    },
    sidebar: 'post'
  };
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?351a523b2429a0dda1b90bb708a00fad";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <title> Andarwin 的 理论，设计与实现 // Neurohazard </title>
</head>

<body>
  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->

  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Neurohazard</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<div class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/">
            <i class="menu-item-icon icon-home"></i> <br />
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            <i class="menu-item-icon icon-about"></i> <br />
            關於
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            <i class="menu-item-icon icon-archives"></i> <br />
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            <i class="menu-item-icon icon-tags"></i> <br />
            標籤
          </a>
        </li>
      
        
        <li class="menu-item menu-item-friend">
          <a href="/friend">
            <i class="menu-item-icon icon-friend"></i> <br />
            友情鏈接
          </a>
        </li>
      
        
        <li class="menu-item menu-item-reading-list">
          <a href="/reading-list">
            <i class="menu-item-icon icon-reading-list"></i> <br />
            閱讀清單
          </a>
        </li>
      
    </ul>
  

  
</div>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              Andarwin 的 理论，设计与实现
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於 2017-02-10
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分類於
            
              <a href="/categories/信息安全/">信息安全</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2017/02/10/Andarwin-summary/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/10/Andarwin-summary/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        <h1 id="Copyright"><a href="#Copyright" class="headerlink" title="Copyright"></a>Copyright</h1><p>shtech.org2017</p>
<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="Extract-Semantic-Vector-Stage"><a href="#Extract-Semantic-Vector-Stage" class="headerlink" title="Extract Semantic Vector Stage"></a>Extract Semantic Vector Stage</h2><p><strong>Table Name</strong>: semantic_vector<br><strong>Field</strong>: { “_id” : ObjectId(“5832a81d3a7cab0d422738f4”), “app_index” : “0”, “app_name” : “0142d70748992bbef33d2e0d5fa525d8a7e537e3.apk”, “method_name” : “<com.baoruan.theme.kkbzkacfigiauxjdxvp.downloadservice$1: void="" <init="">(com.baoruan.theme.kkbzkacfigIauXjdxvP.DownloadService)&gt;”, “method_index” : “1”, “semantic_vector” : [ 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0 ] }</com.baoruan.theme.kkbzkacfigiauxjdxvp.downloadservice$1:></p>
<p>问题 app_name 字段冗余</p>
<h2 id="LSH-Stage"><a href="#LSH-Stage" class="headerlink" title="LSH Stage"></a>LSH Stage</h2><p><strong>Table Name</strong>: sv_lsh<br><strong>Field</strong>: { “_id” : ObjectId(“58289cce3a7cab19b9f055cd”), “hash_code” : “0,-1,-1,-1,-1,-1,0,0,”, “value” : [ [ 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0 ] ], “cluster_id” : 0 , “frequency”: 16}</p>
<h2 id="Minhash-Signature"><a href="#Minhash-Signature" class="headerlink" title="Minhash Signature"></a>Minhash Signature</h2><p>(((346282, 2512263, 2053996, 1613803, 281348, 1093902, 17136, 118044, 10453, 658471, 99073, 7024655, 211376, 2392043, 865, 451707, 1519910, 91361, 506234, 2396259, 2360410, 1812846, 3401448, 1140450, 148422, 616812, 627515, 948804, 85961, 507351, 1534244, 1041838), u’app92’), 0)</p>
<h1 id="基石理念"><a href="#基石理念" class="headerlink" title="基石理念"></a>基石理念</h1><h2 id="层次划分"><a href="#层次划分" class="headerlink" title="层次划分"></a>层次划分</h2><h3 id="App"><a href="#App" class="headerlink" title="App"></a>App</h3><p>通常指一个 apk 文件, 用 dex2jar, enjarify 处理后， 会得到一系列 Java class 文件。</p>
<p>举个例子</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">└── asia</div><div class="line">    └── rgmhpmj</div><div class="line">        └── shlktj</div><div class="line">            └── upuvung</div><div class="line">                ├── a0.class</div><div class="line">                ├── a1.class</div><div class="line">                ├── a2.class</div><div class="line">                ├── a5.class</div><div class="line">                ├── a9.class</div><div class="line">                ├── <span class="selector-tag">a</span>.class</div><div class="line">                ├── b0.class</div><div class="line">                ├── b2.class</div><div class="line">                ├── b3.class</div><div class="line">                ├── b6.class</div><div class="line">                ├── r8.class</div><div class="line">                ├── R<span class="variable">$anim</span>.class</div><div class="line">                ├── R<span class="variable">$attr</span>.class</div><div class="line">                ├── R.class</div><div class="line">                ├── R<span class="variable">$color</span>.class</div><div class="line">                ├── R<span class="variable">$drawable</span>.class</div><div class="line">                ├── R<span class="variable">$id</span>.class</div><div class="line">                ├── R<span class="variable">$integer</span>.class</div><div class="line">                ├── R<span class="variable">$layout</span>.class</div><div class="line">                ├── R<span class="variable">$menu</span>.class</div><div class="line">                ├── R<span class="variable">$string</span>.class</div><div class="line">                ├── R<span class="variable">$style</span>.class</div><div class="line">                ├── s0.class</div><div class="line">                ├── s2.class</div><div class="line">                ├── s8.class</div><div class="line">                ├── s9.class</div><div class="line">                ├── s.class</div><div class="line">                ├── t0.class</div><div class="line">                ├── t2.class</div><div class="line">                ├── t4.class</div><div class="line">                ├── t5.class</div><div class="line">                ├── t9.class</div><div class="line">                ├── t.class</div><div class="line">......</div><div class="line">                ├── z4.class</div><div class="line">                ├── z7.class</div><div class="line">                ├── z8.class</div><div class="line">                └── z9.class</div><div class="line"></div><div class="line"><span class="number">4</span> directories, <span class="number">123</span> files</div></pre></td></tr></table></figure>
<h3 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h3><p>对于一个 Java Class 文件， 它会有若干个 Method。</p>
<p>这里顺带提供一 Java Class 与 Jimple 转换的例子, 详情参考 A Survivor’s Guide to Java Program Analysis with Soot 。</p>
<p>Java Code<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> &#123;</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">    Foo f = <span class="keyword">new</span> Foo();</div><div class="line">    <span class="keyword">int</span> a = <span class="number">7</span>;</div><div class="line">    <span class="keyword">int</span> b = <span class="number">14</span>;</div><div class="line">    <span class="keyword">int</span> x = (f.bar(<span class="number">21</span>) + a) * b;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">bar</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; <span class="keyword">return</span> n + <span class="number">42</span>; &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对应的 Jimple Code<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public static void main(java.lang.String[]) &#123;</div><div class="line">  java.lang.String[] r0;</div><div class="line">  Foo $r1, r2;</div><div class="line">  <span class="keyword">int</span> i0, i1, i2, $i3, $i4;</div><div class="line">  r0 := @parameter0: java.lang.String[];</div><div class="line">  $r1 = new Foo;</div><div class="line">  specialinvoke $r1.&lt;Foo: void &lt;init&gt;()&gt;();</div><div class="line">  r2 = $r1;</div><div class="line">  i0 = <span class="number">7</span>;</div><div class="line">  i1 = <span class="number">14</span>;</div><div class="line">  <span class="comment">// InvokeStmt</span></div><div class="line">  $i3 = virtualinvoke r2.&lt;Foo: <span class="keyword">int</span> bar()&gt;(<span class="number">21</span>);</div><div class="line">  $i4 = $i3 + i0;</div><div class="line">  i2 = $i4 * i1;</div><div class="line">  <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public <span class="keyword">int</span> bar() &#123;</div><div class="line">  Foo r0;</div><div class="line">  <span class="keyword">int</span> i0, $i1;</div><div class="line">  r0 := @this: Foo; <span class="comment">// IdentityStmt</span></div><div class="line">  i0 := @parameter0: <span class="keyword">int</span>; <span class="comment">// IdentityStmt</span></div><div class="line">$i1 = i0 + <span class="number">21</span>; <span class="comment">// AssignStmt</span></div><div class="line"><span class="keyword">return</span> \$i1; <span class="comment">// ReturnStmt</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关于 Jimple 的实现细节 在 soot.jimple 和 soot.jimple.internal 包中。</p>
<p>The Jimple intermediate representation is available in the packages soot.jimple, soot.jimple.internal and an extensive collection of optimizations are available in soot.jimple.toolkits.<em> especially soot.jimple.toolkits.scalar and soot.jimple.toolkits.annotation.\</em>.</p>
<h3 id="Control-Flow-Graph"><a href="#Control-Flow-Graph" class="headerlink" title="Control Flow Graph"></a>Control Flow Graph</h3><p>基于 Soot 生成的控制流图，此处使用的 IR (Intermediate Representations) 是 Jimple 。</p>
<p>关于 Jimple Statement 有哪些类型。<br>具体包括：<br>In Jimple, statements correspond to Soot Units and can be used as such.<br>Jimple has 15 statements, the core statements are:  NopStmt, IdentityStmt and AssignStmt.<br>Statements for intraprocedural control-flow: IfStmt, GotoStmt, TableSwitchStmt(corresponds to the JVM tableswitch instruction) and LookupSwitchStmt(corresponds to the JVM lookupswitch instruction).<br>Statements for interprocedural control-flow: InvokeStmt, ReturnStmt and ReturnVoidStmt. Monitor statements: EnterMonitorStmt and ExitMonitorStmt.<br>The last two are: ThrowStmt, RetStmt (return from a JSR, not created when making Jimple from byte code).</p>
<h3 id="Semantic-Vectors"><a href="#Semantic-Vectors" class="headerlink" title="Semantic Vectors"></a>Semantic Vectors</h3><p>注意到 每一个 App 包含 多个 Java Class， 每一个 Java Class 包含 多个 Java Method.</p>
<p>利用 Soot 和 FlowDroid， 我们将一个 App 中所有的 Java Method 都提取出来，并计算每个 Java Method 的 CFG。<br>每个 Java Method 和 CFG 一一对应。 但 Java Method 可能会出现重复的情况 (例如一些第三方库，在多个App中出现)。并且 CFG 也会出现重复的情况， CFG 出现重复的原因有两种，其一， 这两个 Java Method 的实质内容相同(它们是同一个第三方库的同一个Method，在两个不同的App里均使用了该第三方库); 其二，这两个方法属于不同类的构造方法，它们的内容一致，都使用默认的构造方法方式，即 A.init() 和 B.init(), 在逻辑意义上，他们是不同的方法，但在 CFG层面，内容是一致的。</p>
<p>对 Java Method 生成的 CFG 中统计不同类别 node 的数量，这个结果我们称之为 Semantic Vector。<br>需要说明的是， 从 CFG 到 Semantic Vector， 信息是有损失的。</p>
<p>与 Java Method 一一对应的 CFG 中， 每一个 Node 都代表一个 Jimple 语句 (Jimple Statement)。<br>并且 Jimple 中对不同语句 有做分类， 详见 CFG 章节。</p>
<p>这里有一个比较重要但又容易被忽视的细节，忽略 节点数 过少的 CFG。<br>4.1 Andarwin discards semantic blocks with fewer than 10 nodes, as small semantic blocks typically represent trivial and uncharacteristic code.</p>
<p>[Question]<br>How to determine this threshold？<br>We determined this threshold through manually analyzing apps and discovering that even a few lines of code can result in fairly large semantic blocks once the code is translated into static single assignment form, a requirement for the construction of PDGs. In Section 5.10, we explore ways to capture edge information from the PDGs in the semantic vectors.</p>
<h3 id="Code-Clone-feature"><a href="#Code-Clone-feature" class="headerlink" title="Code Clone (feature)"></a>Code Clone (feature)</h3><p>feature<br>code clone</p>
<p>When two semantic blocks are code clones, they share the majority of their nodes (in CFG) and, thus, their semantic vectors will be similar. Therefore, by finding the nearest neighbors of a semantic vector, we can identify potential code clones.<br><em>Not all of the nearest neighbors will be code clone</em>, as two completely unrelated semantic blocks could have the same frequency of node types. This is due to the lossy nature of our semantic vector characterization: many PDGs may generate the same semantic vector.<br>Specifically, the number of PDGs that generates a given semantic vector increases combinatorially with the magnitude of the semantic vector. Fortunately, our evaluation shows that these collisions are infrequent in practice (Section 5.10).</p>
<p>Code Clone 指 复用代码，或者是稍微修改原始代码<br>此处的思路是， 如果 两个 Method 是 Code Clone， 那么 这两个 Method 的 Semantic Vector 应该是非常接近的(在欧式距离上)。<br>使用 LSH 将 欧式距离接近 的 Semantic Vector 聚成若干个 Approximate Cluster。<br>Cluster 中所有 Semantic Vector 对应的 Method 被认为是 复用或者抄袭。</p>
<h3 id="Feature-Vector"><a href="#Feature-Vector" class="headerlink" title="Feature Vector"></a>Feature Vector</h3><p>每个 Code Clone (Feature) 都有自己的id编号， 每个 Code Clone 会对应一组 Semantic Vector， 而每个Semantic Vector 对应一个 App 的 Method。<br>一个 App 所有的 Method 会对应 一组 Semantic Vector， 这组 Semantic Vector 又会和一组 Code Clone 对应。 取一个维度是 Code Clone 总数的 vector，其中每一维对应一个Code Clone，如果 App 包含该维度对应的 Code Clone，这一维的值为1,否则这维的值为0。 这个 Vector 即是 App 的 Feature Vector。</p>
<h1 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h1><h2 id="semantic-vector"><a href="#semantic-vector" class="headerlink" title="semantic_vector"></a>semantic_vector</h2><p>{ app_id: 1, app_name: dadkjal.apk, method_id:1, method_name: dadkjal.init(), semantic_vector: [1,3,2,4,6,7] }</p>
<p>遍历一遍 semantic vector 表， 为所有 semantic vector 编号<br>{ semantic_vector_id:1, app_id: 1, app_name: dadkjal.apk, method_id:1, method_name: dadkjal.init(), semantic_vector: [1,3,2,4,6,7] }</p>
<h2 id="code-clone-detection"><a href="#code-clone-detection" class="headerlink" title="code_clone_detection"></a>code_clone_detection</h2><p>{ code_clone_id: 1, key: lsh_key, value: [semantic_vector_id1, semantic_vector_id2, semantic_vector_id3] }</p>
<h2 id="feature-vector"><a href="#feature-vector" class="headerlink" title="feature_vector"></a>feature_vector</h2><p>{ app_id:1, value: [code_clone_id1, code_clone_id2 ]}</p>
<h2 id="transposition-feature-vector"><a href="#transposition-feature-vector" class="headerlink" title="transposition_feature_vector"></a>transposition_feature_vector</h2><p>{ code_clone_id:1, value: [app_id1, app_id2, app_id3] }</p>
<h2 id="full-similarity-detection-raw"><a href="#full-similarity-detection-raw" class="headerlink" title="full_similarity_detection_raw"></a>full_similarity_detection_raw</h2><h2 id="full-similarity-detection-merged"><a href="#full-similarity-detection-merged" class="headerlink" title="full_similarity_detection_merged"></a>full_similarity_detection_merged</h2><h2 id="full-similarity-detection-final"><a href="#full-similarity-detection-final" class="headerlink" title="full_similarity_detection_final"></a>full_similarity_detection_final</h2><h2 id="partial-similarity-detection-raw"><a href="#partial-similarity-detection-raw" class="headerlink" title="partial_similarity_detection_raw"></a>partial_similarity_detection_raw</h2><h2 id="partial-similarity-detection-merged"><a href="#partial-similarity-detection-merged" class="headerlink" title="partial_similarity_detection_merged"></a>partial_similarity_detection_merged</h2><h2 id="partial-similarity-detection-final"><a href="#partial-similarity-detection-final" class="headerlink" title="partial_similarity_detection_final"></a>partial_similarity_detection_final</h2><h1 id="新功能实现"><a href="#新功能实现" class="headerlink" title="新功能实现"></a>新功能实现</h1><h2 id="指定-App-找-Code-Clone"><a href="#指定-App-找-Code-Clone" class="headerlink" title="指定 App 找 Code Clone"></a>指定 App 找 Code Clone</h2><p>设待查找App 名字为  A1<br>用 pickle 把 MinhashLSH dump 到磁盘。<br>load MinhashLSH<br>计算 App 的 Feature Vector, 直接 Query A1 的 Feature Vector,可以获得一组 App {A2, A3 … An }， 再 根据 Jaccard Similarity 从高到低排序输出结果。</p>
<h2 id="指定-App-的某个-Method，寻找类似的-Method"><a href="#指定-App-的某个-Method，寻找类似的-Method" class="headerlink" title="指定 App 的某个 Method，寻找类似的 Method"></a>指定 App 的某个 Method，寻找类似的 Method</h2><p>计算 该 Method 的 semantic vector， 在 LSH 中 query 该 semantic vector， 可以得到一个 cluster， 该 cluster 中存储的是一组 semantic_vector_id. 这组 semantic_vector_id 与 某个App的某个Method 一一对应。</p>
<h1 id="关于-Online-Detection-模式"><a href="#关于-Online-Detection-模式" class="headerlink" title="关于 Online Detection 模式"></a>关于 Online Detection 模式</h1><p>????</p>

      
    </div>

    <div class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/"> #Android </a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/14/dex2jar-enjarify/">Android 逆向工具 dex2jar, enjarify 和 AXMLPrinter2</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/01/27/intelligence-and-law-enforcement-device/">情报部门与执法机关的异次元口袋</a>
            
          </div>
        </div>
      

      
      
    </div>
  </div>



    
      <div class="post-spread">
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      </div>
    

    
      <div class="comments" id="comments">
        
          <div class="ds-thread" data-thread-key="2017/02/10/Andarwin-summary/"
               data-title="Andarwin 的 理论，设计与实现" data-url="http://blkstone.github.io/2017/02/10/Andarwin-summary/">
          </div>
        
      </div>
    
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/images/avatar.jpg" alt="Ray" />
          <p class="site-author-name">Ray</p>
        </div>
        <p class="site-description motion-element">关于计算机科学的学习经历与精彩文章分享。</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">445</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">15</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">138</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </div>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/BLKStone" target="_blank">GitHub</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://blkstone.github.io/" target="_blank">Twitter</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://blkstone.github.io/" target="_blank">Weibo</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://blkstone.github.io/" target="_blank">DouBan</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://blkstone.github.io/" target="_blank">ZhiHu</a>
            </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

      </div>

      
        <div class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Copyright"><span class="nav-number">1.</span> <span class="nav-text">Copyright</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据结构"><span class="nav-number">2.</span> <span class="nav-text">数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Extract-Semantic-Vector-Stage"><span class="nav-number">2.1.</span> <span class="nav-text">Extract Semantic Vector Stage</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LSH-Stage"><span class="nav-number">2.2.</span> <span class="nav-text">LSH Stage</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Minhash-Signature"><span class="nav-number">2.3.</span> <span class="nav-text">Minhash Signature</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基石理念"><span class="nav-number">3.</span> <span class="nav-text">基石理念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#层次划分"><span class="nav-number">3.1.</span> <span class="nav-text">层次划分</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#App"><span class="nav-number">3.1.1.</span> <span class="nav-text">App</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Class"><span class="nav-number">3.1.2.</span> <span class="nav-text">Class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Control-Flow-Graph"><span class="nav-number">3.1.3.</span> <span class="nav-text">Control Flow Graph</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Semantic-Vectors"><span class="nav-number">3.1.4.</span> <span class="nav-text">Semantic Vectors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Code-Clone-feature"><span class="nav-number">3.1.5.</span> <span class="nav-text">Code Clone (feature)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Feature-Vector"><span class="nav-number">3.1.6.</span> <span class="nav-text">Feature Vector</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据库设计"><span class="nav-number">4.</span> <span class="nav-text">数据库设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#semantic-vector"><span class="nav-number">4.1.</span> <span class="nav-text">semantic_vector</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#code-clone-detection"><span class="nav-number">4.2.</span> <span class="nav-text">code_clone_detection</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#feature-vector"><span class="nav-number">4.3.</span> <span class="nav-text">feature_vector</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#transposition-feature-vector"><span class="nav-number">4.4.</span> <span class="nav-text">transposition_feature_vector</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#full-similarity-detection-raw"><span class="nav-number">4.5.</span> <span class="nav-text">full_similarity_detection_raw</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#full-similarity-detection-merged"><span class="nav-number">4.6.</span> <span class="nav-text">full_similarity_detection_merged</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#full-similarity-detection-final"><span class="nav-number">4.7.</span> <span class="nav-text">full_similarity_detection_final</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#partial-similarity-detection-raw"><span class="nav-number">4.8.</span> <span class="nav-text">partial_similarity_detection_raw</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#partial-similarity-detection-merged"><span class="nav-number">4.9.</span> <span class="nav-text">partial_similarity_detection_merged</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#partial-similarity-detection-final"><span class="nav-number">4.10.</span> <span class="nav-text">partial_similarity_detection_final</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#新功能实现"><span class="nav-number">5.</span> <span class="nav-text">新功能实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#指定-App-找-Code-Clone"><span class="nav-number">5.1.</span> <span class="nav-text">指定 App 找 Code Clone</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定-App-的某个-Method，寻找类似的-Method"><span class="nav-number">5.2.</span> <span class="nav-text">指定 App 的某个 Method，寻找类似的 Method</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关于-Online-Detection-模式"><span class="nav-number">6.</span> <span class="nav-text">关于 Online Detection 模式</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </div>
      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2015 - 
  2017
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Ray</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.3"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.3"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.3" id="motion.global"></script>



  <script type="text/javascript" src="/js/search-toggle.js"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.3" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var $sidebarInner = $('.sidebar-inner');
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.didShow', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;
          var self = this;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      $(indicator).velocity('stop').velocity({
        opacity: action === 'show' ? 0.4 : 0
      }, { duration: 100 });
    }

  });
</script>


  <script type="text/javascript" id="sidebar.nav">
    $(document).ready(function () {
      var html = $('html');

      $('.sidebar-nav li').on('click', function () {
        var item = $(this);
        var activeTabClassName = 'sidebar-nav-active';
        var activePanelClassName = 'sidebar-panel-active';
        if (item.hasClass(activeTabClassName)) {
          return;
        }

        var currentTarget = $('.' + activePanelClassName);
        var target = $('.' + item.data('target'));

        currentTarget.velocity('transition.slideUpOut', 200, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', 200)
            .addClass(activePanelClassName);
        });

        item.siblings().removeClass(activeTabClassName);
        item.addClass(activeTabClassName);
      });

      $('.post-toc a').on('click', function (e) {
        e.preventDefault();
        var offset = $(escapeSelector(this.getAttribute('href'))).offset().top;
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        });
      });

      // Expand sidebar on post detail page by default, when post has a toc.
      var $tocContent = $('.post-toc-content');
      if (isDesktop() && CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    });
  </script>




  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
    });
  </script>

  
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  
  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"blkstone"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  


  
  

</body>
</html>
